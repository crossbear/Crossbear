Installing OONIBear
===================

Instructions are for Debian and derived distributions.
TODO: Run as root?

1) Installing OONI (www.ooni.nu)

Clone the OONI repository at git.torproject.org/ooni-probe.git

    mkdir ooni-probe && cd ooni-probe && git clone \
    git://git.torproject.org/ooni-probe.git .

Install the virtualenvwrapper to work with python virtualenvs more
easily, and some dependencies for ooni.
  
    apt-get install virtualenvwrapper python-dev tcpdump libpcap-dev \
    libssl-dev tor tor-geoipdb

Set up a virtual python environment for ooni using virtualenvwrapper:

	export WORKON_HOME=~/.virtualenvs
	source /etc/bash_completion.d/virtualenvwrapper
	mkvirtualenv --system-site-packages oonibear

Now you are inside the oonibear virtual environment, and you can
install the OONI requirements.

	pip install --pre -r requirements.txt
	pip install pyrex

Since the debian packages for pypcap and libdnet do not work properly,
the python library needs to be installed manually (instructions taken
from ooni-probe readme). Please ensure you are still in the python
virtual environment!

	cd
	wget https://libdnet.googlecode.com/files/libdnet-1.12.tgz
	tar xzf libdnet-1.12.tgz
	cd libdnet-1.12
	./configure  && make
	cd python/
	python setup.py install
	cd ../../ && rm -rf libdnet-1.12*

	cd
	git clone https://github.com/hellais/pypcap
	cd pypcap/
	python setup.py install
	cd ../ && rm -rf pypcap-read-only

	
2) Installing OONIBear.


The Crossbear/OONIBear repo can reside anywhere on your drive.

First, clone the crossbear repository.

	cd && git clone https://github.com/crossbear/Crossbear crossbear
	cd crossbear/OONIBear

Then, install the crossbear prerequisites:

	apt-get install swig m2crypto
	pip install requests pycrypto

Create symlinks in the ooniprobe directory:

	cd ~/ooniprobe/ooni/
	ln -s ~/crossbear/OONIBear/OONIBear.py
	ln -s ~/crossbear/OONIBear/cb.conf
	ln -s ~/crossbear/OONIBear/cbserver.crt
	ln -s ~/crossbear/OONIBear/PyHunter

That's it. OONIBear will now be accessible to OONI.


3) Calling OONIBear from OONI

Once you've done that, change to root (sudo -s) and then activate
the virtualenv. That's important as otherwise OONI/OONIBear won't
find the necessary python libs (calling ooni-probe with sudo from
within a virtualenv will kick you out of the virtualenv).

	workon oonibear

Start oonibear with:

	cd ooniprobe
	bin/ooniprobe OONIBear.py
